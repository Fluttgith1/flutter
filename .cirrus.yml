# CIRRUS CONFIGURATION FILE
# https://cirrus-ci.org/guide/writing-tasks/

web_shard_template: &WEB_SHARD_TEMPLATE
  only_if: "changesInclude('.cirrus.yml', 'dev/**', 'packages/flutter/**', 'packages/flutter_test/**', 'packages/flutter_tools/lib/src/test/**', 'packages/flutter_web_plugins/**', 'bin/internal/**') || $CIRRUS_PR == ''"
  environment:
    # As of October 2019, the Web shards needed more than 6G of RAM.
    CPU: 2
    MEMORY: 8G
    CHROME_NO_SANDBOX: true
    GOLD_SERVICE_ACCOUNT: ENCRYPTED[3afeea5ac7201151c3d0dc9648862f0462b5e4f55dc600ca8b692319622f7c3eda3d577b1b16cc2ef0311b7314c1c095]
  script:
    - dart --enable-asserts ./dev/bots/test.dart

linux_shard_template: &LINUX_SHARD_TEMPLATE
  environment:
    # Some of the host-only devicelab tests are pretty involved and need a lot of RAM.
    CPU: 2
    MEMORY: 8G
  script:
    - dart --enable-asserts ./dev/bots/test.dart

windows_shard_template: &WINDOWS_SHARD_TEMPLATE
  only_if: "changesInclude('.cirrus.yml', 'dev/**', 'bin/internal/**') || $CIRRUS_PR == ''" # https://github.com/flutter/flutter/issues/41941
  script:
    - dart --enable-asserts ./dev/bots/test.dart

macos_shard_template: &MACOS_SHARD_TEMPLATE
  only_if: "changesInclude('.cirrus.yml', 'dev/**', 'bin/internal/**') || $CIRRUS_PR == ''" # https://github.com/flutter/flutter/issues/41941
  script:
    - ulimit -S -n 2048 # https://github.com/flutter/flutter/issues/2976
    - dart --enable-asserts ./dev/bots/test.dart

use_compute_credits: $CIRRUS_USER_COLLABORATOR == 'true'

environment:
  # For details about environment variables used in Cirrus, including how encrypted variables work,
  # see https://cirrus-ci.org/guide/writing-tasks/#environment-variables
  GCLOUD_SERVICE_ACCOUNT_KEY: ENCRYPTED[f12abe60f5045d619ef4c79b83dd1e0722a0b0b13dbea95fbe334e2db7fffbcd841a5a92da8824848b539a19afe0c9fb]
  # We change Flutter's directory to include a space in its name (see $CIRRUS_WORKING_DIR) so that
  # we constantly test path names with spaces in them. The FLUTTER_SDK_PATH_WITH_SPACE variable must
  # therefore have a space in it.
  FLUTTER_SDK_PATH_WITH_SPACE: "flutter sdk"
  # We force BOT to true so that all our tools know we're in a CI environment. This avoids any
  # dependency on precisely how Cirrus is detected by our tools.
  BOT: "true"
  # Unsetting CIRRUS_CHANGE_MESSAGE and CIRRUS_COMMIT_MESSAGE as they might include non-ASCII
  # characters which makes Gradle crash. See: https://github.com/flutter/flutter/issues/24935
  # TODO(amirha): remove once we've migrated to newer Gradle
  CIRRUS_CHANGE_MESSAGE: ""
  CIRRUS_COMMIT_MESSAGE: ""

# LINUX SHARDS
task:
  container:
    # https://cirrus-ci.org/guide/docker-builder-vm/#dockerfile-as-a-ci-environment
    dockerfile: "dev/ci/docker_linux/Dockerfile"
    cpu: $CPU
    memory: $MEMORY
  environment:
    # We shrink our default resource requirement as much as possible because that way we are more
    # likely to get scheduled. We require 4G of RAM because most of the shards (all but one as of
    # October 2019) just get OOM-killed with less. Some shards may need more. When increasing the
    # requirements for select shards, please leave a comment on those shards saying when you
    # increased the requirements, what numbers you tried, and what the results were.
    CPU: 1 # 0.1-8 without compute credits, 0.1-30 with (yes, you can go fractional)
    MEMORY: 4G # 256M-24G without compute credits, 256M-90G with
    CIRRUS_WORKING_DIR: "/tmp/$FLUTTER_SDK_PATH_WITH_SPACE"
    CIRRUS_DOCKER_CONTEXT: "dev/"
    PATH: "$CIRRUS_WORKING_DIR/bin:$CIRRUS_WORKING_DIR/bin/cache/dart-sdk/bin:$PATH"
    ANDROID_SDK_ROOT: "/opt/android_sdk"
  pub_cache:
    folder: $HOME/.pub-cache
    fingerprint_script: echo $OS; grep -r --include=pubspec.yaml 'PUBSPEC CHECKSUM' "$CIRRUS_WORKING_DIR"
    reupload_on_changes: false
  flutter_pkg_cache:
    folder: bin/cache/pkg
    fingerprint_script: echo $OS; cat bin/internal/*.version
    reupload_on_changes: false
  artifacts_cache:
    folder: bin/cache/artifacts
    fingerprint_script: echo $OS; cat bin/internal/*.version
    reupload_on_changes: false
  setup_script:
    - date
    - git clean -xffd --exclude=bin/cache/
    - git fetch origin
    - git fetch origin master # To set FETCH_HEAD, so that "git merge-base" works.
    - flutter config --no-analytics
    - flutter doctor -v
    - flutter update-packages
    - ./dev/bots/accept_android_sdk_licenses.sh
    - date
  on_failure:
    failure_script:
      - date
      - which flutter
  matrix:
    ######################### 01
    - name: web_tests01-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests01-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests01-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests01-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests01-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests01-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests01-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests01-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 02
    - name: web_tests02-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests02-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests02-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests02-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests02-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests02-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests02-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests02-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 03
    - name: web_tests03-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests03-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests03-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests03-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests03-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests03-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests03-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests03-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 04
    - name: web_tests04-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests04-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests04-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests04-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests04-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests04-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests04-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests04-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 05
    - name: web_tests05-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests05-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests05-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests05-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests05-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests05-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests05-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests05-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 06
    - name: web_tests06-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests06-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests06-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests06-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests06-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests06-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests06-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests06-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 07
    - name: web_tests07-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests07-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests07-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests07-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests07-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests07-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests07-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests07-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 08
    - name: web_tests08-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests08-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests08-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests08-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests08-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests08-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests08-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests08-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 09
    - name: web_tests09-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests09-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests09-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests09-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests09-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests09-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests09-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests09-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 10
    - name: web_tests10-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests10-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests10-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests10-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests10-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests10-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests10-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests10-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 11
    - name: web_tests11-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests11-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests11-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests11-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests11-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests11-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests11-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests11-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 12
    - name: web_tests12-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests12-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests12-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests12-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests12-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests12-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests12-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests12-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 13
    - name: web_tests13-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests13-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests13-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests13-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests13-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests13-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests13-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests13-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 14
    - name: web_tests14-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests14-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests14-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests14-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests14-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests14-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests14-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests14-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 15
    - name: web_tests15-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests15-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests15-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests15-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests15-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests15-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests15-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests15-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 16
    - name: web_tests16-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests16-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests16-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests16-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests16-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests16-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests16-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests16-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 17
    - name: web_tests17-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests17-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests17-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests17-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests17-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests17-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests17-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests17-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 18
    - name: web_tests18-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests18-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests18-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests18-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests18-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests18-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests18-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests18-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 19
    - name: web_tests19-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests19-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests19-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests19-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests19-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests19-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests19-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests19-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 20
    - name: web_tests20-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests20-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests20-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests20-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests20-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests20-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests20-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests20-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 21
    - name: web_tests21-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests21-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests21-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests21-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests21-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests21-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests21-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests21-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 22
    - name: web_tests22-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests22-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests22-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests22-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests22-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests22-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests22-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests22-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 23
    - name: web_tests23-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests23-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests23-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests23-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests23-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests23-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests23-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests23-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 24
    - name: web_tests24-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests24-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests24-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests24-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests24-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests24-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests24-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests24-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 25
    - name: web_tests25-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests25-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests25-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests25-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests25-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests25-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests25-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests25-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 26
    - name: web_tests26-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests26-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests26-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests26-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests26-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests26-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests26-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests26-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 27
    - name: web_tests27-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests27-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests27-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests27-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests27-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests27-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests27-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests27-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 28
    - name: web_tests28-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests28-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests28-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests28-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests28-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests28-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests28-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests28-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 29
    - name: web_tests29-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests29-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests29-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests29-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests29-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests29-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests29-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests29-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

    ######################### 30
    - name: web_tests30-0-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests30-1-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests30-2-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests30-3-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests30-4-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests30-5-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests30-6-linux
      << : *WEB_SHARD_TEMPLATE

    - name: web_tests30-7_last-linux # last Web shard must end with _last
      << : *WEB_SHARD_TEMPLATE

docker_builder:
  # Only build a new docker image when we tag a release (for dev, beta, or
  # stable). Note: tagging a commit and pushing to a release branch are
  # different cirrus triggers. See a tag CI run at e.g.
  # https://cirrus-ci.com/github/flutter/flutter/v1.2.3
  name: docker_build
  only_if: $CIRRUS_TAG != ''
  environment:
    GCLOUD_CREDENTIALS: ENCRYPTED[f7c098d4dd7f5ee1bfee0bb7e944cce72efbe10e97ad6440ae72de4de6a1c24d23f421a2619c668e94377fb64b0bb3e6]
  # Do not add more tasks here. The behavior of failing dependencies is non-ideal for infra health.
  # See also: https://github.com/flutter/flutter/pull/49454
  # depends_on:
  #   - docs-linux
  #   - analyze-linux
  build_script:
    - cd "$CIRRUS_WORKING_DIR/dev/ci/docker_linux"
    - ./docker_build.sh
    - ./docker_login.sh
    - ./docker_push.sh
