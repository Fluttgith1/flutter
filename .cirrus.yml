gcp_credentials: ENCRYPTED[c3e7747bfe6e3f59c60cef44e5789dfa0e88ff4c8602bf2590a64764c23383889fd4e13cd623d4b113a57f965eb38b89]

task:
  env:
    CIRRUS_WORKING_DIR: "/tmp/flutter sdk"
    PATH: "$CIRRUS_WORKING_DIR/bin:$CIRRUS_WORKING_DIR/bin/cache/dart-sdk/bin:$PATH"

  git_fetch_script: git fetch origin
  setup_script: |
    echo "SDK directory is: $PWD"
    ./bin/flutter --version

    # disable analytics on the bots and download Flutter dependencies
    ./bin/flutter config --no-analytics

    # run pub get in all the repo packages
    ./bin/flutter update-packages

    git fetch origin master
  matrix:
    - container:
        image: cirrusci/flutter:base
      matrix:
        - name: docs
          env:
            SHARD: docs
          docs_script: ./dev/bots/docs.sh
        - name: analyze
          env:
            SHARD: analyze
          test_script:
            - dart ./dev/bots/test.dart
    - gke_container:
        cluster_name: build-16-cluster
        image: cirrusci/flutter:base
        cpu: 14
        memory: 50G
        namespace: default
        zone: us-central1-a
      matrix:
        - name: tests-linux
          env:
            SHARD: tests
          test_script:
            - dart ./dev/bots/test.dart
        - name: tool_tests-linux
          env:
            SHARD: tool_tests
          test_script:
            - dart ./dev/bots/test.dart

task:
  name: tests-windows
  env:
    SHARD: tests
  windows_container:
    image: cirrusci/windowsservercore:2016
    os_version: 2016
    cpu: 4
  env:
    CIRRUS_WORKING_DIR: "C:\\Windows\\Temp\\flutter sdk"
  git_fetch_script: git fetch origin
  setup_script:
    - bin\flutter.bat config --no-analytics
    - bin\flutter.bat update-packages
    - git fetch origin master
  test_all_script:
    - bin\cache\dart-sdk\bin\dart.exe -c dev\bots\test.dart

task:
  name: tool_tests-windows
  env:
    SHARD: tool_tests
  windows_container:
    image: cirrusci/windowsservercore:2016
    os_version: 2016
    cpu: 4
  env:
    CIRRUS_WORKING_DIR: "C:\\Windows\\Temp\\flutter sdk"
  git_fetch_script: git fetch origin
  setup_script:
    - bin\flutter.bat config --no-analytics
    - bin\flutter.bat update-packages
    - git fetch origin master
  test_all_script:
    - bin\cache\dart-sdk\bin\dart.exe -c dev\bots\test.dart

task:
  name: tests-macos
  env:
    SHARD: tests
  osx_instance:
    image: high-sierra-xcode-9.4.1
  git_fetch_script: git fetch origin
  setup_script:
    - bin/flutter config --no-analytics
    - bin/flutter update-packages
  test_all_script: |
    ulimit -S -n 2048 # https://github.com/flutter/flutter/issues/2976
    bin/cache/dart-sdk/bin/dart -c dev/bots/test.dart

task:
  name: tool_tests-macos
  env:
    SHARD: tool_tests
  osx_instance:
    image: high-sierra-xcode-9.4.1
  git_fetch_script: git fetch origin
  setup_script:
    - bin/flutter config --no-analytics
    - bin/flutter update-packages
  test_all_script: |
    ulimit -S -n 2048 # https://github.com/flutter/flutter/issues/2976
    bin/cache/dart-sdk/bin/dart -c dev/bots/test.dart
